<div class="image-uploader">
  <label for="productImages" class="upload-label">Upload Product Images</label>
  <input type="file" id="productImages" multiple accept="image/*" hidden>

  <button type="button" class="upload-trigger">Select Images</button>

  <div class="preview-container" id="imagePreviewContainer"></div>
</div>

<script>
  const fileInput = document.getElementById('productImages');
  const triggerBtn = document.querySelector('.upload-trigger');
  const previewContainer = document.getElementById('imagePreviewContainer');

  const selectedImages = [];

  triggerBtn.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', () => {
    const files = Array.from(fileInput.files);

    files.forEach(file => {
      const reader = new FileReader();

      reader.onload = (e) => {
        const url = e.target.result;

        // Check if already added
        if (selectedImages.find(img => img.name === file.name && img.size === file.size)) return;

        selectedImages.push(file);

        const wrapper = document.createElement('div');
        wrapper.className = 'image-wrapper';
        wrapper.setAttribute('data-filename', file.name);

        wrapper.innerHTML = `
          <img src="${url}" alt="${file.name}" class="preview-image" />
          <span class="remove-btn" title="Remove">&times;</span>
        `;

        wrapper.querySelector('.remove-btn').addEventListener('click', () => {
          previewContainer.removeChild(wrapper);
          const index = selectedImages.findIndex(f => f.name === file.name && f.size === file.size);
          if (index > -1) selectedImages.splice(index, 1);
        });

        previewContainer.appendChild(wrapper);
      };

      reader.readAsDataURL(file);
    });

    // Optional: Reset input so same image can be selected again
    fileInput.value = '';
    
    window.selectedImages = selectedImages;
    
  });
  
</script>