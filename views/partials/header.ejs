<nav class="navbar navbar-expand-lg bg-light shadow-sm">
  <div class="container-fluid">
    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center" href="/">
      <img src="/images/all_well_online.png" alt="All Well Online Logo" style="height: 50px;" class="me-2" loading="lazy">
      <span class="h5 mb-0">All Well Online</span>
    </a>

    <!-- Always-visible Right Icons (Cart, Search, Login/Logout) -->
 <div class="d-flex flex-wrap align-items-center order-lg-2">
  <!-- Search Form -->
  <form id="searchForm" class="d-flex me-3 mb-2 mb-lg-0" role="search">
    <input class="form-control me-2" type="search" placeholder="Search products..." id="searchInput" required>
    <button class="btn btn-outline-secondary" type="submit">Search</button>
  </form>

  <!-- Cart Icon -->
  <div class="me-3 position-relative mb-2 mb-lg-0">
    <a href="/cart" class="text-dark fs-5 position-relative">
      <i class="bi bi-cart"></i>
      <% if (cartItemCount > 0) { %>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
          <%= cartItemCount %>
        </span>
      <% } %>
    </a>
  </div>

  <!-- User Info -->
  <div class="d-flex align-items-center mb-2 mb-lg-0">
    <% if (user) { %>
      <span class="me-2"><%= user.name %></span>
      <form action="/auth/logout" method="POST" class="d-inline">
        <input type="hidden" name="redirectTo" value="<%= originalUrl %>">
        <button class="btn btn-sm btn-outline-secondary" type="submit">Logout</button>
      </form>
    <% } else { %>
      <a href="/auth/login" class="btn btn-sm btn-primary">Login</a>
    <% } %>
  </div>
</div>

    <!-- Hamburger Toggler -->
    <button class="navbar-toggler order-lg-3" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible Navigation -->
    <div class="collapse navbar-collapse order-lg-1" id="mainNavbar">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/products">Products</a></li>
        <li class="nav-item"><a class="nav-link" href="/about">About</a></li>

        <% if (user) { %>
          <li class="nav-item">
            <a class="nav-link" href="/dashboard/<%= user.role === 'admin' ? 'admin' : 'user' %>">Profile</a>
          </li>
        <% } %>

        <% if (user && user.role === 'admin') { %>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown">
              Admin Panel
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="/products/constant/product-nature">Add Product</a></li>
              <li><a class="dropdown-item" href="/upload-csv">Bulk Upload</a></li>
              <li><a class="dropdown-item" href="/categories/constant/all-categories">Manage Categories</a></li>
              <li><a class="dropdown-item" href="/orders">Orders</a></li>
            </ul>
          </li>
        <% } %>

        <% if (metaCategories.length > 0) { %>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button" data-bs-toggle="dropdown">
              Categories
            </a>
            <ul class="dropdown-menu">
              <% metaCategories.forEach(category => { %>
                <li>
                  <a class="dropdown-item" href="/categories/main-categories/<%= category._id %>">
                    <%= category.name %>
                  </a>
                </li>
              <% }) %>
            </ul>
          </li>
        <% } %>
      </ul>
    </div>
  </div>
</nav>

<script src="/js/header.js"></script>