<div class="order-details-container">
  <h1 style="font-size: 1rem;">Order ID: <%= order._id %></h1>
  <h4>Status: <%= order.status %></h4>

  <section class="section user-info">
    <h2>Customer Info</h2>
    <p><strong>Name:</strong> <%= user.name %></p>
    <p><strong>Phone:</strong> <%= user.phoneNumber %></p>
  </section>

  <section class="section address">
    <h2>Delivery Address</h2>
    <p><strong>District:</strong> <%= order.deliveryAddress?.district || 'N/A' %></p>
    <p><strong>Village:</strong> <%= order.deliveryAddress?.village || 'N/A' %></p>
    <p><strong>Street:</strong> <%= order.deliveryAddress?.street || 'N/A' %></p>
  </section>

  <section class="section payment">
    <h2>Payment Info</h2>
    <p><strong>Method:</strong> <%= order.paymentMethod === 'prepaid' ? 'MTN Mobile Money' : 'Cash on Delivery' %></p>
    <p><strong>Status:</strong> <%= order.paymentStatus %></p>
    <% if (order.momoNumber) { %>
      <p><strong>Mobile Number:</strong> <%= order.momoNumber %></p>
    <% } %>
  </section>

  <section class="section items">
    <h2>Ordered Items</h2>
    <table class="items-table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Variant</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <% let total = 0; %>
        <% order.items.forEach(item => {
          const price = item.price || 0;
          const subtotal = price * item.quantity;
          total += subtotal;
        %>
          <tr>
            <td><%= item.name %></td>
            <td><%= item.variantName || '-' %></td>
            <td><%= item.quantity %></td>
            <td>UGX <%= price.toLocaleString() %></td>
            <td>UGX <%= subtotal.toLocaleString() %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
    <div class="summary">
      <p><strong>Total:</strong> UGX <%= order.total.toLocaleString() %></p>
    </div>
  </section>

  <% if (user.role === 'admin') { %>
    <section class="section admin-actions">
      <h2>Admin Actions</h2>

      <form action="/orders/<%= order._id %>/status" method="POST" class="status-form">
        <label for="newStatus">Change Order Status:</label>
        <select name="newStatus" id="newStatus">
          <option selected><%= order.status || 'Pending' %></option>
          <option value="Processing">Processing</option>
          <option value="Shipped">Shipped</option>
          <option value="Delivered">Delivered</option>
          <option value="Cancelled">Cancelled</option>
        </select>
        <button type="submit">Update Status</button>
      </form>

      <form action="/orders/<%= order._id %>/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this order?');">
        <button type="submit" class="danger-btn">Delete Order</button>
      </form>
    </section>
  <% } %>
</div>